<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Demográfico - Puerto Carreño</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <style>
        body {
            display: flex; /* Para que el sidebar y el main estén uno al lado del otro */
            min-height: 100vh;
            overflow-x: hidden; /* Evita scroll horizontal */
        }
        .sidebar {
            width: 250px;
            flex-shrink: 0; /* Evita que el sidebar se encoja */
            background-color: #f8f9fa; /* Color de fondo para el sidebar */
            padding: 1rem;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #dee2e6; /* Separador */
        }
        .main-content {
            flex-grow: 1;
            padding: 1.5rem;
            background-color: #e9ecef; /* Color de fondo para el contenido principal */
            display: flex;
            flex-direction: column;
        }
        .barra-box {
            background-color: #fff;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0.375rem;
            box-shadow: 0 .125rem .25rem rgba(0,0,0,.075);
        }
        .grafica-box {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 0.375rem;
            box-shadow: 0 .5rem 1rem rgba(0,0,0,.15);
            flex-grow: 1; /* Permite que el contenedor de gráficas ocupe el espacio restante */
            overflow-y: auto; /* Habilita scroll vertical si el contenido es muy grande */
        }
        .card {
            border: none;
            box-shadow: 0 .125rem .25rem rgba(0,0,0,.075);
        }
        /* Contenedor específico para cada canvas para controlar la altura */
        .chart-container {
            position: relative;
            height: 300px; /* Altura fija para la gráfica, ajusta según sea necesario */
            width: 100%;
            margin-bottom: 1rem; /* Espacio entre gráficas */
        }
        .logo-box img {
            max-width: 70px;
            height: auto;
            object-fit: contain;
        }
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0;
            color: #343a40 !important;
        }
        .nav-link:hover {
            color: #0d6efd !important;
        }
    </style>
</head>
<body>
    
    <aside class="sidebar">
        <div class="logo-box text-center mb-4">
            <img src="logo.png" alt="Logo Gobernación">
            <p class="mt-2 fw-bold text-dark">Gobernación</p>
        </div>
        
        <nav class="nav-item-box flex-column">
            <ul class="nav flex-column">
                <li class="nav-item mb-2">
                    <a href="#" class="nav-link">
                        <i class="bi bi-people-fill"></i>
                        Población
                    </a>
                </li>
                <li class="nav-item mb-2">
                    <a href="#" class="nav-link">
                        <i class="bi bi-pencil-fill"></i>
                        Educación
                    </a>
                </li>
                <li class="nav-item mb-2">
                    <a href="#" class="nav-link">
                        <i class="bi bi-bandaid-fill"></i>
                        Salud
                    </a>
                </li>
                <li class="nav-item mb-2">
                    <a href="#" class="nav-link">
                        <i class="bi bi-suitcase-lg-fill"></i>
                        Demografía
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <div class="barra-box">
            <h3>Dashboard Puerto Carreño</h3>
        </div>
        
        <div class="grafica-box">
            <h2 class="text-center text-secondary mb-4">Análisis Demográfico (Escala 1,000 Personas)</h2>
            
            <div id="graficas" class="row">
                <div class="col-md-6 mb-4">
                    <div class="card p-3 h-100">
                         <h5 class="card-title text-center mb-3">Distribución por Sexo</h5>
                        <div class="chart-container">
                            <canvas id="chart_sexo"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card p-3 h-100">
                        <h5 class="card-title text-center mb-3">Distribución por Rango de Edad</h5>
                        <div class="chart-container">
                            <canvas id="chart_edad"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-4">
                    <div class="card p-3 h-100">
                         <h5 class="card-title text-center mb-3">Composición Étnica</h5>
                        <div class="chart-container">
                            <canvas id="chart_etnia"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-4">
                    <div class="card p-3 h-100">
                         <h5 class="card-title text-center mb-3">Dialectos/Lenguas Dominantes</h5>
                        <div class="chart-container">
                            <canvas id="chart_dialecto"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6g5C8e4u+zU+uW1eT80d2Yl+xS7vP6V92eE4x1D/V6b4E70r/vQ" crossorigin="anonymous"></script>

    <script>
        // 1. DATOS DE POBLACIÓN
        const PUERTO_CARREÑO_DATA = {
            "poblacion_total_escalada": 1000,
            "sexo": [
                { "label": "Femenino", "count": 473 },
                { "label": "Masculino", "count": 527 }
            ],
            "rango_edad": [
                { "label": "< 12 años", "count": 248 },
                { "label": "12 a 17 años", "count": 119 },
                { "label": "18 a 24 años", "count": 137 },
                { "label": "25 a 29 años", "count": 88 },
                { "label": "30 a 34 años", "count": 81 },
                { "label": "35 a 39 años", "count": 74 },
                { "label": "40 a 44 años", "count": 63 },
                { "label": "45 a 49 años", "count": 48 },
                { "label": "50 a 54 años", "count": 41 },
                { "label": "55 a 59 años", "count": 34 },
                { "label": "60 a 64 años", "count": 27 },
                { "label": "65 años o más", "count": 40 }
            ],
            "etnia": [
                { "label": "No Indígena", "count": 762 },
                { "label": "Sikuani", "count": 131 },
                { "label": "Curripaco", "count": 71 },
                { "label": "Piaroa", "count": 36 }
            ],
            "dialecto": [
                { "label": "Español (Principal)", "count": 762 },
                { "label": "Sikuani (Lengua Nativa)", "count": 131 },
                { "label": "Curripaco (Lengua Nativa)", "count": 71 },
                { "label": "Piaroa (Lengua Nativa)", "count": 36 }
            ]
        };

        // Colores para las gráficas
        const COLORS_BASE = [
            '#0d6efd', '#dc3545', '#ffc107', '#20c997', '#6f42c1', '#fd7e14', '#17a2b8', '#6c757d',
            '#343a40', '#007bff', '#28a745', '#1e90ff', '#f8f9fa', '#6610f2', '#e83e8c', '#6f42c1'
        ];
        
        // 2. FUNCIÓN PARA CREAR GRÁFICAS DE CHART.JS
        function createChart(chartId, type, dataKey, colors) {
            const dataSet = PUERTO_CARREÑO_DATA[dataKey];
            
            const labels = dataSet.map(item => item.label);
            const data = dataSet.map(item => item.count);
            
            const ctx = document.getElementById(chartId).getContext('2d');

            const config = {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Número de Personas (escala 1000)',
                        data: data,
                        backgroundColor: colors.slice(0, data.length),
                        borderColor: '#fff',
                        borderWidth: 1 // Borde más fino para mejor visualización en pequeño
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // CLAVE: Permite que la gráfica se ajuste al contenedor del canvas
                    plugins: {
                        legend: {
                            position: type === 'bar' ? 'top' : 'right', // Leyenda a la derecha para circulares, arriba para barras
                            labels: {
                                font: {
                                    size: 10 // Tamaño de fuente para la leyenda
                                }
                            }
                        },
                        title: {
                            display: false, // El título ya está en la card
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    const total = data.reduce((sum, val) => sum + val, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1) + '%';
                                    label += context.parsed + ' (' + percentage + ')';
                                    return label;
                                }
                            },
                            bodyFont: {
                                size: 10 // Tamaño de fuente para el tooltip
                            }
                        }
                    },
                    scales: (type === 'bar' || type === 'line') ? {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Conteo (escala 1000)',
                                font: {
                                    size: 10
                                }
                            },
                            ticks: {
                                font: {
                                    size: 9
                                }
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 9
                                }
                            }
                        }
                    } : {}
                }
            };

            new Chart(ctx, config);
        }

        // 3. RENDERIZAR TODAS LAS GRÁFICAS
        document.addEventListener('DOMContentLoaded', function() {
            createChart('chart_sexo', 'doughnut', 'sexo', ['#0d6efd', '#dc3545']);
            createChart('chart_edad', 'bar', 'rango_edad', COLORS_BASE);
            createChart('chart_etnia', 'doughnut', 'etnia', ['#20c997', '#ffc107', '#fd7e14', '#0d6efd']);
            createChart('chart_dialecto', 'pie', 'dialecto', ['#0d6efd', '#ffc107', '#dc3545', '#20c997']);
        });

    </script>
</body>
</html> 